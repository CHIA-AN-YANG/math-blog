<template>
  <div class="tag-list">
    <h3>Tags</h3>
    <div class="tags">
      <button 
        v-for="tag in uniqueTags" 
        :key="tag"
        :class="{ active: selectedTag === tag }"
        @click="selectTag(tag)"
      >
        {{ tag }}
      </button>
    </div>
    
    <h3>Articles</h3>
    <ul>
      <li v-for="post in filteredPosts" :key="post.path">
        <a :href="post.path">{{ post.title }}</a>
      </li>
    </ul>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue'
import { useData } from 'vitepress'

const { theme } = useData()
const selectedTag = ref(null)

const posts = computed(() => {
  return theme.value.sidebar['/posts/'][0].items.map(post => ({
    ...post,
    tags: post.tags || []
  }))
})

const uniqueTags = computed(() => {
  const tags = new Set()
  posts.value.forEach(post => {
    post.tags?.forEach(tag => tags.add(tag))
  })
  return Array.from(tags)
})

const filteredPosts = computed(() => {
  if (!selectedTag.value) return posts.value
  return posts.value.filter(post => post.tags?.includes(selectedTag.value))
})

const selectTag = (tag) => {
  selectedTag.value = selectedTag.value === tag ? null : tag
}
</script>

<style scoped>
.tag-list {
  padding: 1rem;
}

.tags {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin-bottom: 1rem;
}

button {
  padding: 0.25rem 0.75rem;
  border: 1px solid var(--vp-c-divider);
  border-radius: 4px;
  background: transparent;
  cursor: pointer;
}

button.active {
  background: var(--vp-c-brand);
  color: white;
}

ul {
  list-style: none;
  padding: 0;
}

li {
  margin-bottom: 0.5rem;
}

a {
  color: var(--vp-c-text-1);
  text-decoration: none;
}

a:hover {
  color: var(--vp-c-brand);
}
</style>